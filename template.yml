AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

Metadata:
  AWS::ServerlessRepo::Application:
    Name: timestamp-custom-resource
    Description: This example serverless application creates a custom resource that returns a timestamp as an ISO 8601 string.
    Author: James Hood
    SpdxLicenseId: MIT
    # paths are relative to .aws-sam/build directory
    LicenseUrl: ../../LICENSE
    ReadmeUrl: ../../README.md
    Labels: [serverless, custom-resource, examples]
    HomePageUrl: https://github.com/jlhood/timestamp-custom-resource
    # Update the semantic version and run sam publish to publish a new version of your app
    SemanticVersion: 0.0.1
    SourceCodeUrl: https://github.com/jlhood/timestamp-custom-resource/tree/0.0.1

Parameters:
  LogLevel:
    Type: String
    Description: Log level for Lambda function logging, e.g., ERROR, INFO, DEBUG, etc
    Default: INFO

Resources:
  GenerateTimestamp:
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: src/
      Handler: generatetimestamp.handler
      Runtime: python3.7
      Tracing: Active
      Timeout: 5
      Environment:
        Variables:
          LOG_LEVEL: !Ref LogLevel

  Timestamp:
    Type: AWS::CloudFormation::CustomResource
    Properties:
      ServiceToken: !GetAtt GenerateTimestamp.Arn

Outputs:
  Timestamp:
    Description: "Timestamp generated by custom resource as ISO8601 string."
    Value: !GetAtt Timestamp.Timestamp